<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Анализатор шахматных партий</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e6e6e6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #ff9a9e 0%, #fad0c4 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.8;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .chess-board-container {
            flex: 1;
            min-width: 400px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .controls {
            flex: 1;
            min-width: 400px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        h2 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #64b5f6;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            color: #e6e6e6;
            font-size: 1rem;
        }
        
        button {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .button-group button {
            flex: 1;
            min-width: 120px;
        }
        
        .evaluation-buttons {
            display: grid;

            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        
        .eval-btn {
            padding: 10px;
            text-align: center;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .eval-btn:hover {
            transform: scale(1.05);
        }
        
        .blunder {
            background: #ff5252;
        }
        
        .mistake {
            background: #ff9800;
        }
        
        .dubious {
            background: #ffeb3b;
            color: #333;
        }
        
        .good {
            background: #4caf50;
        }
        
        .excellent {
            background: #2196f3;
        }
        
        .moves-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        
        .moves-table th, .moves-table td {
            padding: 12px 15px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .moves-table th {
            background: rgba(255, 255, 255, 0.1);
            font-weight: 600;
        }
        
        .moves-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .current-move {
            background: rgba(100, 181, 246, 0.2) !important;
        }
        
        .evaluation {
            font-weight: bold;
        }
        
        .board {
            width: 100%;
            max-width: 400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: repeat(8, 1fr);
            aspect-ratio: 1 / 1;
            border: 2px solid #333;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .square {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .square:hover {
            opacity: 0.9;
        }
        
        .white {
            background-color: #f0d9b5;
            color: #333;
        }
        
        .black {
            background-color: #b58863;
            color: #fff;
        }
        
        .selected {
            background-color: rgba(100, 181, 246, 0.5) !important;
        }
        
        .possible-move {
            position: relative;
        }
        
        .possible-move::after {
            content: "";
            position: absolute;
            width: 25%;
            height: 25%;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 50%;
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            font-size: 1.1rem;
        }
        
        .status {
            font-weight: 500;
            color: #64b5f6;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            margin-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.9rem;
            opacity: 0.7;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .chess-board-container, .controls {
                min-width: 100%;
            }
            
            .evaluation-buttons {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-chess-board"></i> Анализатор шахматных партий</h1>

<p class="subtitle">Анализируйте ходы и оценивайте их качество с помощью стандартных шахматных обозначений</p>
        </header>
        
        <div class="main-content">
            <div class="chess-board-container">
                <h2>Шахматная доска</h2>
                <div class="board" id="board">
                </div>
                <div class="game-info">
                    <div class="status" id="status">Ход белых</div>
                    <div id="move-counter">Ход: 1</div>
                </div>
            </div>
            
            <div class="controls">
                <div class="panel">
                    <h2>Управление партией</h2>
                    <div class="input-group">
                        <label for="pgn-input">Введите партию в формате PGN:</label>
                        <textarea id="pgn-input" rows="4" placeholder="[Event &quot;Пример партии&quot;]
[Site &quot;?&quot;]
[Date &quot;2023.??.??&quot;]
[Round &quot;?&quot;]
[White &quot;?&quot;]
[Black &quot;?&quot;]
[Result &quot;*&quot;]

1. e4 e5 2. Nf3 Nc6 3. Bb5 a6 4. Ba4 Nf6 5. O-O Be7 6. Re1 b5 7. Bb3 d6 8. c3 O-O 9. h3 Nb8 10. d4 Nbd7 11. Nbd2 Bb7 12. Bc2 Re8 13. Nf1 Bf8 14. Ng3 g6 15. a4 c5 16. d5 c4 17. Bg5 h6 18. Be3 Nc5 19. Qd2 Kh7 20. Bh6 Bh8 21. b4 cxb3 22. Bxb3 Nxb3 23. Qxb3 Rc8 24. Rec1 Qc7 25. Qb4 Rc4 26. Qb1 Qc5 27. Nd2 Rxc3 28. Rxc3 Qxc3 29. Qxb5 Qxa1 30. Qxb7 Qc3 31. Qb1 Qc7 32. Kh2 Ng8 33. f4 exf4 34. Bxf4 Ne7 35. Qb5 Re5 36. Qb1 Kg8 37. Nf3 Rc5 38. Nd4 Nf5 39. Nxf5 gxf5 40. exf5 Bxd5 41. Qb3+ Kg7 42. Bh6+ Kxh6 43. Qxd5 Qc2+ 44. Kh1 Qf2 0-1"></textarea>
                    </div>
                    <div class="button-group">
                        <button id="load-pgn-btn"><i class="fas fa-upload"></i> Загрузить PGN</button>
                        <button id="start-btn"><i class="fas fa-play"></i> Новая партия</button>
                        <button id="prev-btn"><i class="fas fa-step-backward"></i> Назад</button>
                        <button id="next-btn"><i class="fas fa-step-forward"></i> Вперед</button>
                    </div>
                </div>
                
                <div class="panel">
                    <h2>Оценка ходов</h2>
                    <p>Выберите ход в таблице и оцените его качество:</p>
                    <div class="evaluation-buttons">
                        <div class="eval-btn blunder" data-eval="??">?? (Грубая ошибка)</div>
                        <div class="eval-btn mistake" data-eval="?">? (Ошибка)</div>
                        <div class="eval-btn dubious" data-eval="!?">!? (Сомнительный ход)</div>
                        <div class="eval-btn good" data-eval="!">! (Хороший ход)</div>
                        <div class="eval-btn excellent" data-eval="!!">!! (Отличный ход)</div>
                    </div>
                </div>
                
                <div class="panel">
                    <h2>Ходы партии</h2>
                    <table class="moves-table" id="moves-table">
                        <thead>
                            <tr>
                                <th>№</th>
                                <th>Белые</th>
                                <th>Черные</th>
                            </tr>
                        </thead>
                        <tbody id="moves-body">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Анализатор шахматных партий &copy; 2023 | Создано для удобного анализа ходов</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {

            const boardElement = document.getElementById('board');
            const movesBody = document.getElementById('moves-body');
            const statusElement = document.getElementById('status');
            const moveCounterElement = document.getElementById('move-counter');
            const pgnInput = document.getElementById('pgn-input');
            const loadPgnBtn = document.getElementById('load-pgn-btn');
            const startBtn = document.getElementById('start-btn');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const evalButtons = document.querySelectorAll('.eval-btn');
            
            let game = new Chess();
            let currentMoveIndex = 0;
            let moveEvaluations = {};
            
            function createBoard() {
                boardElement.innerHTML = '';
                const files = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h'];
                const pieces = {
                    'r': '♜', 'n': '♞', 'b': '♝', 'q': '♛', 'k': '♚', 'p': '♟',
                    'R': '♖', 'N': '♘', 'B': '♗', 'Q': '♕', 'K': '♔', 'P': '♙'
                };
                
                for (let rank = 7; rank >= 0; rank--) {
                    for (let file = 0; file < 8; file++) {
                        const square = document.createElement('div');
                        square.className = square ${(rank + file) % 2 === 0 ? 'white' : 'black'};
                        square.dataset.square = files[file] + (rank + 1);
                        
                        const piece = game.get(files[file] + (rank + 1));
                        if (piece) {
                            square.textContent = pieces[piece.color === 'w' ? piece.type.toUpperCase() : piece.type];
                        }
                        
                        square.addEventListener('click', handleSquareClick);
                        boardElement.appendChild(square);
                    }
                }
                
                updateStatus();
            }
            
            function updateStatus() {
                let status = '';
                
                if (game.in_checkmate()) {
                    status = Мат! Победа ${game.turn() === 'w' ? 'черных' : 'белых'};
                } else if (game.in_draw()) {
                    status = 'Ничья!';
                } else {
                    status = Ход ${game.turn() === 'w' ? 'белых' : 'черных'};
                    if (game.in_check()) {
                        status += ', шах';
                    }
                }
                
                statusElement.textContent = status;
                moveCounterElement.textContent = Ход: ${Math.ceil(currentMoveIndex / 2) + (currentMoveIndex % 2 === 0 ? 0 : 0.5)};
            }
            
            function handleSquareClick(e) {
                const square = e.target.dataset.square;
                alert(Выбрана клетка: ${square}. В полнофункциональном приложении здесь можно было бы делать ходы.);
            }
            
            function updateMovesTable() {
                movesBody.innerHTML = '';
                const moves = game.history();
                const movesWithNumbers = [];
                
                for (let i = 0; i < moves.length; i += 2) {
                    movesWithNumbers.push({
                        number: Math.floor(i / 2) + 1,

                        white: moves[i],
                        black: moves[i + 1] || ''
                    });
                }
                
                movesWithNumbers.forEach(move => {
                    const row = document.createElement('tr');
                    if (currentMoveIndex === (move.number - 1) * 2) {
                        row.classList.add('current-move');
                    }
                    
                    row.innerHTML = 
                        <td>${move.number}</td>
                        <td class="move-cell" data-move-index="${(move.number - 1) * 2}">
                            ${move.white}
                            ${moveEvaluations[(move.number - 1) * 2] ? <span class="evaluation">${moveEvaluations[(move.number - 1) * 2]}</span> : ''}
                        </td>
                        <td class="move-cell" data-move-index="${(move.number - 1) * 2 + 1}">
                            ${move.black}
                            ${moveEvaluations[(move.number - 1) * 2 + 1] ? <span class="evaluation">${moveEvaluations[(move.number - 1) * 2 + 1]}</span> : ''}
                        </td>
                    ;
                    
                    movesBody.appendChild(row);
                });
                
                document.querySelectorAll('.move-cell').forEach(cell => {
                    cell.addEventListener('click', function() {
                        const moveIndex = parseInt(this.dataset.moveIndex);
                        selectMove(moveIndex);
                    });
                });
            }
            
            function selectMove(moveIndex) {
                currentMoveIndex = moveIndex;
                updateMovesTable();
                
                alert(Выбран ход с индексом ${moveIndex}. В полнофункциональном приложении можно было бы перейти к этому ходу на доске.);
            }
            
            loadPgnBtn.addEventListener('click', function() {
                try {
                    game.load_pgn(pgnInput.value);
                    currentMoveIndex = game.history().length;
                    createBoard();
                    updateMovesTable();
                    alert('Партия успешно загружена!');
                } catch (e) {
                    alert('Ошибка при загрузке PGN: ' + e.message);
                }
            });
            
            startBtn.addEventListener('click', function() {
                game = new Chess();
                currentMoveIndex = 0;
                moveEvaluations = {};
                createBoard();
                updateMovesTable();
                pgnInput.value = '';
                alert('Новая партия начата!');
            });
            
            prevBtn.addEventListener('click', function() {
                if (currentMoveIndex > 0) {
                    currentMoveIndex--;
                    updateMovesTable();
                    alert('Переход к предыдущему ходу. В полнофункциональном приложении доска обновилась бы.');
                }
            });
            
            nextBtn.addEventListener('click', function() {
                const moves = game.history();
                if (currentMoveIndex < moves.length) {
                    currentMoveIndex++;
                    updateMovesTable();
                    alert('Переход к следующему ходу. В полнофункциональном приложении доска обновилась бы.');

}
            });
            
            evalButtons.forEach(button => {
                button.addEventListener('click', function() {
                    if (currentMoveIndex > 0) {
                        const evaluation = this.dataset.eval;
                        moveEvaluations[currentMoveIndex] = evaluation;
                        updateMovesTable();
                        alert(Ход ${currentMoveIndex} оценен как: ${evaluation});
                    } else {
                        alert('Пожалуйста, выберите ход для оценки.');
                    }
                });
            });
            
            createBoard();
            updateMovesTable();
            
            setTimeout(() => {
                moveEvaluations[1] = '!';
                moveEvaluations[4] = '?';
                moveEvaluations[7] = '!!';
                moveEvaluations[10] = '??';
                moveEvaluations[15] = '!?';
                updateMovesTable();
            }, 1000);
        });
    </script>
</body>
</html>
